# 🌐 在线多人协作使用指南

本指南将教你如何使用TRPG助手的在线多人协作功能，让你和朋友们可以远程一起跑团！

## 📊 两种模式对比

### 🏠 本地模式（默认）
- ✅ 无需配置，开箱即用
- ✅ 数据保存在浏览器本地
- ❌ 无法多人协作
- ❌ 数据不能跨设备同步
- 💡 适合：单人使用、离线使用

### ☁️ 在线模式（需配置Supabase）
- ✅ 多人实时协作
- ✅ 云端数据存储
- ✅ 跨设备同步
- ✅ 实时骰子同步
- ✅ 实时战斗追踪
- 💡 适合：多人跑团、远程游戏

## 🚀 启用在线模式

### 第一步：配置Supabase

详细步骤请查看 **[SUPABASE_SETUP.md](./SUPABASE_SETUP.md)**

简要步骤：
1. 注册Supabase账号
2. 创建新项目
3. 运行数据库初始化脚本
4. 配置环境变量
5. 重启开发服务器

### 第二步：验证配置

启动项目后，查看右下角的状态指示器：

- 🟢 **"在线模式"** - 配置成功！
- 🟡 **"本地模式"** - 还在使用本地存储

## 🎮 在线协作功能

### 1. 创建在线房间

**作为GM（游戏主持人）：**

1. 点击 **"房间"** 标签
2. 点击 **"创建房间"** 按钮
3. 填写房间信息：
   - 房间名称：如"周五晚上的冒险"
   - 游戏系统：COC/DND/通用
4. 点击 **"创建"**
5. 房间创建成功！

### 2. 邀请玩家加入

**分享房间ID：**

1. 进入你创建的房间
2. 复制房间ID（显示在房间信息中）
3. 通过以下方式分享给朋友：
   - 微信/QQ
   - Discord
   - 邮件
   - 任何聊天工具

**玩家加入步骤：**

1. 玩家打开TRPG助手
2. 点击 **"房间"** 标签
3. 在房间列表中找到你的房间
4. 点击 **"加入"** 按钮
5. 成功加入！

### 3. 实时骰子同步

**功能说明：**
- 任何人投掷骰子，房间内所有人立即看到
- 显示投掷者信息
- 保留完整历史记录

**使用方法：**

1. 在 **"骰子"** 标签页投掷骰子
2. 结果会自动同步到房间内所有玩家
3. 所有人都能看到：
   - 谁投的骰子
   - 投掷表达式
   - 投掷结果
   - 是否成功/大成功/大失败

**示例场景：**
```
玩家A投掷: 1d100 (侦察检定)
结果: 45 (成功!)
→ 所有玩家立即看到这个结果
```

### 4. 实时战斗追踪

**功能说明：**
- GM管理战斗，玩家实时查看
- 先攻顺序自动同步
- HP变化实时更新
- 状态效果同步显示

**GM操作：**

1. 点击 **"战斗"** 标签
2. 点击 **"开始战斗"**
3. 添加参与者（玩家和怪物）
4. 管理战斗：
   - 切换回合
   - 调整HP
   - 添加状态效果
5. 所有操作实时同步给玩家

**玩家视角：**

1. 点击 **"战斗"** 标签
2. 自动看到当前战斗状态
3. 实时查看：
   - 当前回合是谁
   - 所有参与者的HP
   - 状态效果
   - 回合数

### 5. 在线状态显示

**功能说明：**
- 查看谁在线
- 实时显示房间成员
- 离线/在线状态提示

**查看方法：**
- 在房间页面查看成员列表
- 绿点表示在线
- 灰点表示离线

## 💡 使用技巧

### 技巧1: GM权限管理

**GM可以：**
- 创建和删除房间
- 管理战斗追踪器
- 查看所有玩家的骰子投掷
- 清除骰子历史

**玩家可以：**
- 加入和离开房间
- 投掷骰子
- 查看战斗状态
- 管理自己的角色卡

### 技巧2: 骰子投掷最佳实践

**公开投掷：**
```
在房间内投掷 → 所有人看到
适用于：属性检定、攻击投掷等
```

**私密投掷：**
```
在"骰子"标签页投掷（不在房间内）→ 只有自己看到
适用于：GM的秘密投掷、玩家的私密检定
```

### 技巧3: 战斗管理

**战斗前准备：**
1. 提前创建好所有NPC/怪物
2. 让玩家准备好先攻值
3. 按先攻顺序添加参与者

**战斗中：**
1. 使用"下一个"按钮切换回合
2. 及时更新HP
3. 添加状态效果提醒
4. 使用战斗日志记录重要事件

**战斗后：**
1. 点击"结束战斗"
2. 战斗数据会保存
3. 可以查看战斗历史

### 技巧4: 数据同步

**自动同步：**
- 骰子投掷 → 立即同步
- 战斗状态 → 实时更新
- 房间成员 → 自动刷新

**手动刷新：**
- 如果数据没有更新，刷新页面（F5）
- 检查网络连接
- 查看右下角状态指示器

## 🎯 典型使用场景

### 场景1: 远程跑团

**准备阶段：**
1. GM创建房间
2. 分享房间ID给玩家
3. 玩家加入房间
4. 所有人准备好角色卡

**游戏阶段：**
1. GM描述场景
2. 玩家投掷检定
3. 结果实时显示
4. 进入战斗时使用战斗追踪器

**结束阶段：**
1. 保存重要数据
2. 导出角色卡
3. 记录游戏进度

### 场景2: 混合模式跑团

**线下+线上：**
- 部分玩家在现场
- 部分玩家远程参与
- 使用TRPG助手同步状态
- 所有人都能看到骰子和战斗

### 场景3: 异步游戏

**适合时区不同的玩家：**
1. GM设置场景
2. 玩家在自己的时间投掷
3. 查看历史记录了解进度
4. 通过聊天工具配合

## 🐛 常见问题

### 问题1: 骰子投掷不同步

**可能原因：**
- 网络连接问题
- 没有在房间内投掷
- Supabase配置错误

**解决方案：**
1. 检查右下角状态指示器
2. 确认在房间内
3. 刷新页面
4. 检查网络连接

### 问题2: 看不到其他玩家

**可能原因：**
- 玩家没有加入房间
- 网络延迟
- 浏览器缓存问题

**解决方案：**
1. 确认玩家已加入房间
2. 刷新房间成员列表
3. 清除浏览器缓存
4. 重新加入房间

### 问题3: 战斗状态不更新

**可能原因：**
- 实时订阅断开
- 网络问题
- 权限问题

**解决方案：**
1. 刷新页面
2. 检查GM权限
3. 重新开始战斗
4. 查看浏览器控制台错误

### 问题4: 数据丢失

**预防措施：**
- 定期导出角色卡
- 保存重要骰子记录
- 截图重要战斗
- 使用云端存储

**恢复方法：**
- 从导出文件恢复角色卡
- 查看Supabase数据库
- 联系GM获取备份

## 📱 移动端使用

**支持情况：**
- ✅ 手机浏览器完全支持
- ✅ 平板设备完全支持
- ✅ 响应式设计自动适配

**使用建议：**
- 横屏使用体验更好
- 使用Chrome/Safari浏览器
- 保持网络连接稳定

## 🔒 隐私和安全

**数据安全：**
- 所有数据加密传输
- 行级安全策略保护
- 只有房间成员能看到数据

**隐私保护：**
- 不会分享你的个人信息
- 房间ID只有你知道
- 可以随时删除数据

## 🎉 开始在线跑团！

现在你已经掌握了所有在线协作功能，可以：

1. ✅ 配置Supabase后端
2. ✅ 创建在线房间
3. ✅ 邀请朋友加入
4. ✅ 开始远程跑团！

**祝你游戏愉快！🎲✨**

---

## 📚 相关文档

- [SUPABASE_SETUP.md](./SUPABASE_SETUP.md) - Supabase配置指南
- [README.md](./README.md) - 项目说明
- [QUICKSTART.md](./QUICKSTART.md) - 快速启动指南

## 🆘 需要帮助？

- 查看文档中的常见问题
- 在项目Issues中提问
- 加入社区讨论

