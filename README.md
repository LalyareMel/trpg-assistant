# 🎲 TRPG助手 - 跑团辅助工具

一个功能完整的桌面角色扮演游戏(TRPG)辅助工具，支持COC、DND等多种游戏系统。

**🌐 支持在线多人实时协作！**
- **P2P联机** - 零配置，创建房间即可开始（推荐！）
- **Supabase后端** - 数据持久化，适合长期使用

## ✨ 功能特性

### 🎲 骰子系统
- 支持多种骰子类型：d4, d6, d8, d10, d12, d20, d100
- 骰子表达式解析（如：2d6+3, 1d20, 3d8-2）
- COC检定系统（困难/常规/简单）
- DND检定系统（优势/劣势）
- 完整的投掷历史记录
- 大成功/大失败判定

### 👤 角色卡管理
- **COC 7版角色卡**
  - 完整的属性系统（STR, CON, SIZ, DEX, APP, INT, POW, EDU, LUCK）
  - 衍生属性（HP, MP, SAN, MOV, DB, BUILD）
  - 自定义技能管理
  
- **DND 5E角色卡**
  - 六大属性及调整值自动计算
  - 战斗属性（HP, AC, 先攻, 速度）
  - 豁免投掷
  - 技能和特性管理

- **通用角色卡**
  - 自定义属性系统
  - 自定义资源管理（HP/MP等）
  - 自定义技能
  - 笔记功能

- 角色导入/导出（JSON格式）
- 本地存储，数据持久化

### 🏠 房间系统（支持在线协作）

#### 🌐 P2P联机（推荐！零配置）
- ⚡ **即刻开始** - 无需任何配置
- 🎯 **6位房间码** - 创建房间获得房间码，分享给朋友
- 🔄 **实时同步** - 骰子、战斗状态自动同步
- 👥 **2-6人** - 适合小团队临时跑团
- 💯 **完全免费** - 使用P2P技术，无需服务器

#### ☁️ Supabase后端（可选，需配置）
- 💾 **数据持久化** - 云端存储，永不丢失
- 📊 **历史记录** - 完整的游戏历史
- 🔄 **跨设备同步** - 手机、电脑无缝切换
- 👥 **无限人数** - 支持大型团队
- 🔐 **用户认证** - 安全的账号系统

### ⚔️ 战斗追踪器
- 先攻顺序自动排序
- HP实时追踪（可视化血条）
- AC和护甲等级管理
- 状态效果管理（中毒、眩晕等）
- 回合计数
- 玩家/NPC标记

## 🚀 快速开始

### 📖 三种使用模式

#### 🏠 本地模式（默认）
无需任何配置，开箱即用！数据保存在浏览器本地。

#### 🌐 P2P联机模式（推荐！）
**零配置在线协作** - 创建房间获得6位房间码，分享给朋友即可开始！
- ⚡ 无需注册账号
- ⚡ 无需配置服务器
- ⚡ 3分钟内开始游戏

#### ☁️ Supabase模式（可选）
配置Supabase后端，支持数据持久化和高级功能。

---

### 前置要求
- Node.js 18+
- npm 或 yarn

### 安装依赖

```bash
npm install
# 或
yarn install
```

### 运行开发服务器

```bash
npm run dev
# 或
yarn dev
```

打开浏览器访问 [http://localhost:3000](http://localhost:3000)

### 🌐 在线协作（两种方式）

#### 方式1: P2P联机（推荐！零配置）

**3分钟开始：**
1. 打开应用，点击"P2P联机"标签
2. 输入你的名字
3. 创建房间，获得6位房间码
4. 分享房间码给朋友
5. 开始游戏！

**详细指南：[P2P_GUIDE.md](./P2P_GUIDE.md)**

#### 方式2: Supabase后端（需配置）

如果需要数据持久化和高级功能：

1. 查看详细配置指南：**[SUPABASE_SETUP.md](./SUPABASE_SETUP.md)**
2. 按照步骤配置Supabase
3. 重启开发服务器
4. 右下角显示"在线模式"即配置成功！

**在线功能使用指南：[ONLINE_GUIDE.md](./ONLINE_GUIDE.md)**

### 构建生产版本

```bash
npm run build
npm start
# 或
yarn build
yarn start
```

## 📦 技术栈

- **框架**: Next.js 14 (App Router)
- **语言**: TypeScript
- **样式**: Tailwind CSS
- **图标**: Lucide React
- **状态管理**: React Hooks + localStorage
- **后端**: Supabase (可选，用于在线协作)
- **实时通信**: Supabase Realtime
- **数据库**: PostgreSQL (Supabase)

## 🔧 配置

### 本地存储模式（默认）
当前版本使用浏览器的localStorage进行数据持久化，无需额外配置即可使用。

### Supabase后端模式（可选）
要启用多人实时协作功能，需要配置Supabase：

1. 在 [Supabase](https://supabase.com) 创建项目
2. 复制 `.env.example` 为 `.env.local`
3. 填入你的Supabase配置：
```env
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
```

4. 创建数据库表（SQL脚本待添加）

## 📖 使用指南

### 骰子投掷
1. 在"骰子"标签页输入骰子表达式（如：2d6+3）
2. 或点击快速骰子按钮（d20, d100等）
3. 使用游戏系统检定按钮进行COC或DND检定
4. 查看历史记录中的所有投掷结果

### 角色卡管理
1. 在"角色卡"标签页点击"创建角色"
2. 选择游戏系统（COC/DND/通用）
3. 填写角色信息和属性
4. 点击"编辑"修改角色
5. 使用"导出"保存角色到本地文件
6. 使用"导入"加载已保存的角色

### 房间管理
1. 在"房间"标签页点击"创建房间"
2. 输入房间名称并选择游戏系统
3. 分享房间ID给其他玩家
4. 其他玩家可以通过房间ID加入

### 战斗追踪
1. 在"战斗"标签页点击"开始战斗"
2. 添加参与者（角色或怪物）
3. 输入先攻值、HP、AC等信息
4. 点击"下一个"切换回合
5. 使用+/-按钮调整HP
6. 添加状态效果（中毒、眩晕等）
7. 战斗结束后点击"结束战斗"

## 🎮 支持的游戏系统

- **COC (克苏鲁的呼唤)** - 7版规则
- **DND (龙与地下城)** - 5E规则
- **通用系统** - 适用于其他TRPG游戏

## 🛣️ 开发路线图

- [x] 基础骰子系统
- [x] COC和DND角色卡
- [x] 战斗追踪器
- [x] 房间管理
- [ ] Supabase后端集成
- [ ] 实时多人协作
- [ ] 用户认证系统
- [ ] 角色卡模板库
- [ ] 战斗日志导出
- [ ] 移动端优化
- [ ] 暗色/亮色主题切换
- [ ] 更多游戏系统支持

## 📝 许可证

MIT License

## 🤝 贡献

欢迎提交Issue和Pull Request！

## 📧 联系方式

如有问题或建议，请提交Issue。

---

**祝你游戏愉快！🎲✨**

