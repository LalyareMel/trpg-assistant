# 🌐 P2P联机指南 - 零配置在线跑团

## 🎉 什么是P2P联机？

P2P（点对点）联机是一种**无需任何配置**的在线协作方式！

### ✨ 核心优势

| 特性 | P2P联机 | Supabase方案 |
|------|---------|-------------|
| **配置难度** | ⭐ 零配置 | ⭐⭐⭐⭐ 需要配置 |
| **使用步骤** | 2步（创建→分享） | 10+步（注册、配置、部署） |
| **技术要求** | 无 | 需要理解数据库、API等 |
| **费用** | 完全免费 | 免费（有限额） |
| **连接速度** | 快（直连） | 中等（经过服务器） |
| **适用场景** | 临时跑团、小团队 | 长期使用、大团队 |

---

## 🚀 快速开始（3分钟）

### 步骤1: GM创建房间

1. 打开TRPG助手
2. 点击 **"P2P联机"** 标签
3. 输入你的名字（如"GM小明"）
4. 点击 **"创建房间"**
5. 获得6位房间码（如 `123456`）

### 步骤2: 分享房间码

将6位房间码发送给玩家：
- 微信/QQ
- Discord
- 任何聊天工具

### 步骤3: 玩家加入

玩家操作：
1. 打开TRPG助手
2. 点击 **"P2P联机"** 标签
3. 输入自己的名字（如"玩家小红"）
4. 输入6位房间码
5. 点击 **"加入房间"**

### 步骤4: 开始游戏！

✅ 所有人已连接  
✅ 骰子自动同步  
✅ 战斗状态实时更新  
✅ 开始跑团！

---

## 💡 工作原理

### 技术说明

P2P联机使用 **WebRTC** 技术：

```
GM的浏览器 ←→ 玩家A的浏览器
      ↓
   玩家B的浏览器
```

**特点：**
- 🔒 数据直接在浏览器之间传输
- ⚡ 低延迟（通常 < 100ms）
- 🆓 不需要服务器存储数据
- 🌐 使用免费的STUN服务器建立连接

### 为什么不需要配置？

- ✅ 使用公共STUN服务器（Google提供）
- ✅ 使用PeerJS免费信令服务器
- ✅ 所有连接自动建立
- ✅ 无需注册账号

---

## 🎮 使用场景

### ✅ 适合P2P联机的场景

1. **临时跑团**
   - 今晚突然想跑团
   - 不想花时间配置
   - 快速开始游戏

2. **小团队（2-6人）**
   - 人数不多
   - 网络环境良好
   - 临时组队

3. **测试和演示**
   - 测试新规则
   - 演示游戏玩法
   - 快速体验

### ❌ 不适合P2P联机的场景

1. **大型团队（7+人）**
   - P2P连接数量有限
   - 建议使用Supabase方案

2. **需要数据持久化**
   - P2P不保存历史数据
   - 房间关闭后数据丢失
   - 建议使用Supabase方案

3. **网络环境差**
   - 防火墙限制
   - 公司网络
   - 建议使用Supabase方案

---

## 📊 功能对比

### P2P联机支持的功能

| 功能 | 支持情况 | 说明 |
|------|---------|------|
| 实时骰子同步 | ✅ | 所有人立即看到 |
| 实时战斗追踪 | ✅ | GM管理，玩家查看 |
| 在线状态显示 | ✅ | 显示谁在线 |
| 房间成员列表 | ✅ | 实时更新 |
| 聊天功能 | ⏳ | 计划中 |
| 数据持久化 | ❌ | 不支持 |
| 历史记录 | ❌ | 不支持 |
| 跨设备同步 | ❌ | 不支持 |

### 与Supabase方案对比

| 功能 | P2P联机 | Supabase |
|------|---------|----------|
| 配置难度 | ⭐ 零配置 | ⭐⭐⭐⭐ 复杂 |
| 连接速度 | ⚡ 快 | 🐢 中等 |
| 数据持久化 | ❌ | ✅ |
| 历史记录 | ❌ | ✅ |
| 跨设备同步 | ❌ | ✅ |
| 用户认证 | ❌ | ✅ |
| 适用人数 | 2-6人 | 无限制 |
| 费用 | 免费 | 免费（有限额） |

---

## 🔧 常见问题

### Q1: 房间码是什么？

**A:** 房间码是一个6位数字（如 `123456`），用于标识你的游戏房间。

- GM创建房间时自动生成
- 玩家输入房间码加入
- 每次创建都会生成新的房间码

### Q2: 房间码会过期吗？

**A:** 不会过期，但有以下情况会失效：

- GM关闭浏览器或离开房间
- 所有人都离开房间
- 网络连接中断

### Q3: 数据会保存吗？

**A:** 不会。P2P联机的数据只在当前会话中存在：

- ❌ 关闭浏览器后数据丢失
- ❌ 没有历史记录
- ❌ 不能跨设备访问

**如果需要数据持久化，请使用Supabase方案。**

### Q4: 为什么连接失败？

**可能原因：**

1. **房间码输入错误**
   - 检查是否为6位数字
   - 确认没有多余空格

2. **GM已离开房间**
   - GM必须保持在线
   - GM关闭浏览器会导致房间关闭

3. **网络问题**
   - 检查网络连接
   - 尝试刷新页面
   - 重新创建房间

4. **防火墙限制**
   - 公司网络可能阻止P2P连接
   - 尝试使用手机热点
   - 或使用Supabase方案

### Q5: 可以同时有多少人？

**A:** 建议2-6人：

- ✅ 2-4人：最佳体验
- ⚠️ 5-6人：可以使用，可能有延迟
- ❌ 7+人：不推荐，建议使用Supabase

### Q6: GM离开后会怎样？

**A:** 房间会关闭：

- 所有玩家断开连接
- 数据全部丢失
- 需要重新创建房间

**建议：** GM保持在线直到游戏结束

### Q7: 可以中途加入吗？

**A:** 可以，但有限制：

- ✅ 可以随时加入
- ❌ 看不到之前的历史记录
- ❌ 看不到之前的骰子投掷

### Q8: 安全吗？

**A:** 相对安全：

- ✅ 数据直接在浏览器之间传输
- ✅ 不经过第三方服务器
- ⚠️ 房间码知道的人都能加入
- ⚠️ 建议不要分享房间码到公开场合

---

## 💡 使用技巧

### 技巧1: 提前测试

在正式游戏前：
1. 提前10分钟创建房间
2. 让玩家测试连接
3. 确认所有人都能看到同步

### 技巧2: 备用方案

准备备用联系方式：
- 微信群/QQ群
- Discord语音
- 如果P2P断开，可以快速沟通

### 技巧3: 保存重要数据

定期保存重要信息：
- 截图角色卡
- 记录重要骰子结果
- 保存战斗状态

### 技巧4: 网络优化

获得最佳体验：
- 使用有线网络（而非WiFi）
- 关闭其他占用带宽的应用
- 确保网络稳定

### 技巧5: GM注意事项

作为GM：
- 保持浏览器标签页打开
- 不要刷新页面
- 不要关闭浏览器
- 游戏结束前不要离开房间

---

## 🆚 选择哪种方案？

### 选择P2P联机，如果你：

- ✅ 想要立即开始，不想配置
- ✅ 临时跑团，不需要保存数据
- ✅ 小团队（2-6人）
- ✅ 网络环境良好
- ✅ 不需要历史记录

### 选择Supabase，如果你：

- ✅ 需要数据持久化
- ✅ 需要历史记录
- ✅ 大团队（7+人）
- ✅ 长期使用
- ✅ 需要跨设备同步
- ✅ 愿意花时间配置

### 两者都用？

完全可以！

- **日常使用**：P2P联机（快速方便）
- **重要战役**：Supabase（数据安全）

---

## 🎯 实际使用示例

### 示例1: 周五晚上的临时跑团

**场景：**
- 时间：周五晚上8点
- 人数：1个GM + 3个玩家
- 需求：快速开始，玩2-3小时

**步骤：**
1. 7:55 - GM创建P2P房间
2. 7:56 - 在微信群分享房间码
3. 7:57 - 所有玩家加入
4. 8:00 - 开始游戏
5. 11:00 - 游戏结束，GM关闭房间

**结果：** ✅ 完美！5分钟内所有人就绪

### 示例2: 长期战役

**场景：**
- 时间：每周六下午
- 人数：1个GM + 5个玩家
- 需求：保存进度，持续数月

**建议：** ❌ 不适合P2P，应该使用Supabase

**原因：**
- 需要保存角色成长
- 需要查看历史记录
- 需要跨周同步数据

---

## 🔄 从P2P迁移到Supabase

如果你开始使用P2P，后来想要数据持久化：

### 迁移步骤

1. **导出角色卡**
   - 在"角色卡"页面导出JSON
   - 保存到本地

2. **配置Supabase**
   - 查看 SUPABASE_SETUP.md
   - 完成配置

3. **导入角色卡**
   - 在Supabase模式下导入JSON
   - 数据自动同步到云端

4. **通知玩家**
   - 告知新的房间方式
   - 分享新的房间ID

---

## 📱 移动端使用

P2P联机完全支持移动端！

### 手机浏览器

- ✅ Chrome（Android）
- ✅ Safari（iOS）
- ✅ Edge（Android）

### 使用建议

- 横屏使用体验更好
- 确保网络稳定
- 建议使用WiFi而非移动数据

---

## 🎉 开始使用

准备好了吗？

### 立即开始：

1. 打开TRPG助手
2. 点击 **"P2P联机"** 标签
3. 输入你的名字
4. 创建或加入房间
5. 开始跑团！

**就是这么简单！🎲✨**

---

## 📚 相关文档

- [README.md](./README.md) - 项目总览
- [QUICKSTART.md](./QUICKSTART.md) - 快速启动
- [SUPABASE_SETUP.md](./SUPABASE_SETUP.md) - Supabase配置（如需数据持久化）
- [ONLINE_GUIDE.md](./ONLINE_GUIDE.md) - Supabase在线功能指南

---

**祝你游戏愉快！🎲✨**

**P2P联机 - 零配置，即刻开始！**

